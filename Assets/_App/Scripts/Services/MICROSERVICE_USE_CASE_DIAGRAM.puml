@startuml Tower Defense - Use Case Diagram

!theme plain

' Styling
skinparam usecase {
  BackgroundColor #E8F4F8
  BorderColor #2E7D9A
  FontSize 11
}
skinparam actor {
  BackgroundColor #FFF2CC
  BorderColor #D6B656
  FontSize 12
}
skinparam package {
  BackgroundColor #F5F5F5
  BorderColor #999999
  FontSize 13
  FontStyle bold
}

left to right direction

' ===== PRIMARY ACTOR (Left side) =====
actor "Player" as player

' ===== SECONDARY ACTORS (Right side - External Systems) =====
actor "Firebase\nAuthentication" as firebase_auth
actor "Firestore\nDatabase" as firestore

' ===== AUTHENTICATION DOMAIN =====
package "ðŸ” Authentication" {
  usecase "Sign In with Google" as UC_SignInGoogle
  usecase "Sign In with Email" as UC_SignInEmail
  usecase "Sign Up" as UC_SignUp
  usecase "Sign Out" as UC_SignOut
  usecase "Authenticate User" as UC_Authenticate
}

' ===== USER PROFILE DOMAIN =====
package "ðŸ‘¤ User Management" {
  usecase "Load User Data" as UC_LoadUserData
  usecase "Save User Data" as UC_SaveUserData
  usecase "View Profile" as UC_ViewProfile
  usecase "View Level Progress" as UC_ViewProgress
  usecase "Sync Progress" as UC_SyncProgress
}

' ===== INVENTORY DOMAIN =====
package "ðŸŽ’ Inventory Management" {
  usecase "View Inventory" as UC_ViewInventory
  usecase "Select Towers" as UC_SelectTowers
  usecase "Unlock Tower" as UC_UnlockTower
  usecase "Check Requirements" as UC_CheckRequirements
  usecase "Save Inventory" as UC_SaveInventory
}

' ===== LEVEL DOMAIN =====
package "ðŸ—ºï¸ Level Management" {
  usecase "Browse Levels" as UC_BrowseLevels
  usecase "Select Level" as UC_SelectLevel
  usecase "Load Level Config" as UC_LoadLevelConfig
  usecase "Check Level Unlock" as UC_CheckLevelUnlock
}

' ===== GAMEPLAY DOMAIN =====
package "ðŸŽ® Gameplay" {
  usecase "Start Level" as UC_StartLevel
  usecase "Build Tower" as UC_BuildTower
  usecase "Upgrade Tower" as UC_UpgradeTower
  usecase "Sell Tower" as UC_SellTower
  usecase "Defend Against Enemies" as UC_DefendBase
  usecase "Manage Currency" as UC_ManageCurrency
  usecase "Complete Level" as UC_CompleteLevel
  usecase "Win Level" as UC_WinLevel
  usecase "Lose Level" as UC_LoseLevel
}

' ===== PLAYER PRIMARY ACTIONS =====
' Authentication
player --> UC_SignInGoogle
player --> UC_SignInEmail
player --> UC_SignUp
player --> UC_SignOut

' User Management
player --> UC_ViewProfile
player --> UC_ViewProgress

' Inventory
player --> UC_ViewInventory
player --> UC_SelectTowers
player --> UC_UnlockTower

' Level Selection
player --> UC_BrowseLevels
player --> UC_SelectLevel

' Gameplay
player --> UC_StartLevel
player --> UC_BuildTower
player --> UC_UpgradeTower
player --> UC_SellTower
player --> UC_DefendBase

' ===== FIREBASE AUTH INTERACTIONS =====
UC_SignInGoogle --> firebase_auth
UC_SignInEmail --> firebase_auth
UC_SignUp --> firebase_auth
UC_SignOut --> firebase_auth

' ===== FIRESTORE INTERACTIONS =====
UC_LoadUserData --> firestore
UC_SaveUserData --> firestore
UC_SaveInventory --> firestore
UC_SyncProgress --> firestore

' ===== USE CASE RELATIONSHIPS =====

' Authentication Flow
UC_SignInGoogle ..> UC_Authenticate : <<include>>
UC_SignInEmail ..> UC_Authenticate : <<include>>
UC_SignUp ..> UC_Authenticate : <<include>>
UC_Authenticate ..> UC_LoadUserData : <<include>>

' Profile & Progress
UC_ViewProfile ..> UC_LoadUserData : <<include>>
UC_ViewProgress ..> UC_LoadUserData : <<include>>

' Inventory Flow
UC_ViewInventory ..> UC_LoadUserData : <<include>>
UC_SelectTowers ..> UC_SaveInventory : <<include>>
UC_UnlockTower ..> UC_CheckRequirements : <<include>>
UC_UnlockTower ..> UC_SaveInventory : <<include>>

' Level Selection Flow
UC_BrowseLevels ..> UC_ViewProgress : <<include>>
UC_SelectLevel ..> UC_CheckLevelUnlock : <<include>>
UC_SelectLevel ..> UC_LoadLevelConfig : <<include>>

' Gameplay Flow
UC_StartLevel ..> UC_LoadLevelConfig : <<include>>
UC_StartLevel ..> UC_ViewInventory : <<include>>
UC_BuildTower ..> UC_ManageCurrency : <<include>>
UC_UpgradeTower ..> UC_ManageCurrency : <<include>>
UC_SellTower ..> UC_ManageCurrency : <<include>>
UC_DefendBase ..> UC_WinLevel : <<extend>>
UC_DefendBase ..> UC_LoseLevel : <<extend>>
UC_WinLevel ..> UC_CompleteLevel : <<include>>
UC_LoseLevel ..> UC_CompleteLevel : <<include>>
UC_CompleteLevel ..> UC_SyncProgress : <<include>>
UC_CompleteLevel ..> UC_UnlockTower : <<extend>>
UC_CompleteLevel ..> UC_SaveUserData : <<include>>

' ===== NOTES =====
note right of UC_SelectTowers
  Maximum 3 towers can
  be selected for a level
end note

note bottom of UC_UnlockTower
  Towers unlock based on
  level completion progress
end note

note left of UC_DefendBase
  Core gameplay loop:
  - Spawn enemies in waves
  - Towers attack automatically
  - Player manages strategy
end note

@enduml

