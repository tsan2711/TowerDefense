@startuml Tower Defense - Tower Library Filtering

!theme plain

skinparam activity {
  BackgroundColor #E8F4F8
  BorderColor #2E7D9A
  FontSize 11
}
skinparam activityStartEnd {
  BackgroundColor #FFE6CC
  BorderColor #D79B00
  FontSize 11
}
skinparam activityDecision {
  BackgroundColor #FFF2CC
  BorderColor #D6B656
  FontSize 10
}
skinparam partition {
  BackgroundColor #F5F5F5
  BorderColor #999999
  FontSize 12
  FontStyle bold
}
skinparam note {
  BackgroundColor #FFF9E6
  BorderColor #D6B656
  FontSize 10
}

title ðŸ—¼ Tower Library Filtering

start

:Level starts;
:Get levelId;

partition "Load Required Data" {
  fork
    :Load TowerLibrary for level;
  fork again
    :Get player maxLevel;
  fork again
    :Get selected towers from inventory;
  end fork
}

partition "Determine Unlocked Types" {
  :Create unlocked types set;
  :Add MachineGun (always);
  
  if (maxLevel >= 2?) then (yes)
    :Add Rocket;
  endif
  
  if (maxLevel >= 3?) then (yes)
    :Add Emp;
  endif
  
  if (maxLevel >= 4?) then (yes)
    :Add Laser;
  endif
  
  note right
    Progressive unlock system
    based on player level
  end note
}

partition "Filter & Match" {
  :Load tower prefabs from Resources;
  :Get selected tower names;
  
  repeat
    :Get next tower prefab;
    
    if (Tower type unlocked?) then (yes)
      if (Tower in selection?) then (yes)
        :Add to filtered library;
      else (no)
        :Skip;
      endif
    else (no)
      :Skip locked tower;
    endif
    
  repeat while (More towers?) is (yes)
  ->no;
}

partition "Validate & Finalize" {
  if (All selected matched?) then (yes)
    :Log success;
  else (no)
    :Log warning;
  endif
  
  :Build final TowerLibrary;
  :Fire towerLibraryUpdated event;
}

:Level ready with towers;

stop

@enduml

